redmine-scripts
===============

Some useful scripts for redmine administration


#### 01_show-tags.sh
Показывает какие версии (теги) доступны

#### 02_check-beta.sh
Показывает в каком состоянии сейчас находятся рабочие копии бета и продакшн версий (ветки и последние 3 коммита)

#### 03_reset-beta.sh
Возвращает бета к текущему состоянию мастера, сохраняя его branching model. Также выполняет развёртывание.

  A---B---C develop_2.5.0
 /
D---E---F---G master

Полезно на случай если вдруг вы или кто-то из разработчиков что-то напутает с git'ом в бета-репозитарии и проще
будет потерять все изменения и откатиться до последних стабильных правок.

#### 04_update-master.sh
ОБновляет продакшн-версию из беты и выполяет развёртывание. 
Миграция базы также используется стандартная - rake db:migrate.




#### null_beta.sh
возвращает репозитарий бета-версии к "нулевому состоянию" (удаляет все ветки и заново создает ветку core).
Файлы оказываются в состоянии последнего к сегодняшнему дню коммита. 
Redmine после неё работать не будет, т.к. не прописывается database.yml


#### upgrade-beta.sh
обновляет бета-версию до выбранной версии из списка тегов (01_show-tags.sh). Используется стандартная миграция базы,
не удаляющая пользовательские данные (rake db:migrate RAILS_ENV=production)


#### compare-db.sh
сравнивает две схемы базы данных и возвращает ответ в виде upgrade и downgrade-миграции (файлы в каталоге migrations). развёртывает оба приложения по адресам old.redmine.fablab61.ru и beta.redmine.fablab61.ru
внимание! для развёртывания старой версии используется gem mysql вместо mysql2, поэтому первым параметром задавать версии не выше 2.1.0,
иначе нет гарантии что скрипт сработает.




#### Структура проекта

#### /configs

/configs/main.cfg - главный файл конфигурации для всех скриптов (здесь прописаны все пути)<br>
Конфигурационные файлы. Не забудьте сюда вписать свои пароли :)

#### /cron
всё, что неплохо бы запихать в crontab.
backup.sh - бэкап продакшн-базы по расписанию. Складывает всё в BACKUP_DIR, определенную в главном конфигурационном файле.

#### /perl
Скрипты на Perl

dbi_version.pl - добавляет много полезной информации в бекап о базе данных. Использует DBI<br>
test_http.pl - тестирует ответы сервера используя Mojo::Test<br>
